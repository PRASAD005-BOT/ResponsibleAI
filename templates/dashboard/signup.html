{% extends 'base.html' %}

{% block title %}Sign Up - AI Ethics Platform{% endblock %}

{% block content %}
<section class="auth-section">
    <div class="container">
        <div class="auth-container glass-effect">
            <div class="auth-header">
                <h1 class="auth-title fade-in-up">Create an Account</h1>
                <p class="auth-subtitle fade-in-up" style="animation-delay: 0.2s;">Join our AI ethics community and start building responsible AI</p>
            </div>
            
            <form method="post" class="auth-form fade-in-up" style="animation-delay: 0.3s;" id="signupForm">
                {% csrf_token %}
                {% if form.hidden_tag %}{{ form.hidden_tag }}{% endif %}
                
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="{{ form.first_name.id_for_label }}" class="floating-label">First Name</label>
                        <div class="input-with-icon">
                            <i class="fas fa-user"></i>
                            {{ form.first_name }}
                        </div>
                        {% if form.first_name.errors %}
                            <div class="error-message animated shake">
                                {{ form.first_name.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group col-md-6">
                        <label for="{{ form.last_name.id_for_label }}" class="floating-label">Last Name</label>
                        <div class="input-with-icon">
                            <i class="fas fa-user"></i>
                            {{ form.last_name }}
                        </div>
                        {% if form.last_name.errors %}
                            <div class="error-message animated shake">
                                {{ form.last_name.errors }}
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.username.id_for_label }}" class="floating-label">Username</label>
                    <div class="input-with-icon">
                        <i class="fas fa-user-tag"></i>
                        {{ form.username }}
                    </div>
                    {% if form.username.errors %}
                        <div class="error-message animated shake">
                            {{ form.username.errors }}
                        </div>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ form.email.id_for_label }}" class="floating-label">Email</label>
                    <div class="input-with-icon">
                        <i class="fas fa-envelope"></i>
                        {{ form.email }}
                    </div>
                    {% if form.email.errors %}
                        <div class="error-message animated shake">
                            {{ form.email.errors }}
                        </div>
                    {% endif %}
                </div>
                
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="{{ form.organization.id_for_label }}" class="floating-label">Organization (optional)</label>
                        <div class="input-with-icon">
                            <i class="fas fa-building"></i>
                            {{ form.organization }}
                        </div>
                        {% if form.organization.errors %}
                            <div class="error-message animated shake">
                                {{ form.organization.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group col-md-6">
                        <label for="{{ form.job_title.id_for_label }}" class="floating-label">Job Title (optional)</label>
                        <div class="input-with-icon">
                            <i class="fas fa-briefcase"></i>
                            {{ form.job_title }}
                        </div>
                        {% if form.job_title.errors %}
                            <div class="error-message animated shake">
                                {{ form.job_title.errors }}
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.password1.id_for_label }}" class="floating-label">Password</label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock"></i>
                        {{ form.password1 }}
                    </div>
                    {% if form.password1.errors %}
                        <div class="error-message animated shake">
                            {{ form.password1.errors }}
                        </div>
                    {% endif %}
                    <small class="text-muted password-helper">{{ form.password1.help_text }}</small>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.password2.id_for_label }}" class="floating-label">Confirm Password</label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock"></i>
                        {{ form.password2 }}
                    </div>
                    {% if form.password2.errors %}
                        <div class="error-message animated shake">
                            {{ form.password2.errors }}
                        </div>
                    {% endif %}
                </div>
                
                {% if form.non_field_errors %}
                    <div class="error-message animated shake">
                        {{ form.non_field_errors }}
                    </div>
                {% endif %}
                
                <button type="submit" class="btn btn-primary btn-lg btn-block pulse-effect">
                    <span class="btn-text">Create Account</span>
                    <span class="btn-icon"><i class="fas fa-user-plus"></i></span>
                </button>
            </form>
            
            <div class="auth-links fade-in-up" style="animation-delay: 0.4s;">
                <p>Already have an account? <a href="{% url 'dashboard:login' %}" class="highlight-link">Login</a></p>
            </div>
        </div>
    </div>
</section>

<!-- Notification system -->
<div id="notification-container"></div>

<!-- Add some animated particles for visual interest -->
<div class="particles-container">
    <div id="particles-js"></div>
</div>

{% block extra_css %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
{% endblock %}
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize particles background
        particlesJS('particles-js', {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: '#0077ff' },
                shape: { type: 'circle' },
                opacity: { value: 0.5, random: false },
                size: { value: 3, random: true },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: '#0077ff',
                    opacity: 0.4,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 2,
                    direction: 'none',
                    random: false,
                    straight: false,
                    out_mode: 'out',
                    bounce: false
                }
            },
            interactivity: {
                detect_on: 'canvas',
                events: {
                    onhover: { enable: true, mode: 'grab' },
                    onclick: { enable: true, mode: 'push' },
                    resize: true
                }
            },
            retina_detect: true
        });

        // Create notification function
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.className = `notification notification-${type} animated fadeInRight`;
            
            // Icons based on notification type
            let icon = '';
            switch(type) {
                case 'success':
                    icon = '<i class="fas fa-check-circle"></i>';
                    break;
                case 'error':
                    icon = '<i class="fas fa-exclamation-circle"></i>';
                    break;
                case 'warning':
                    icon = '<i class="fas fa-exclamation-triangle"></i>';
                    break;
                default:
                    icon = '<i class="fas fa-info-circle"></i>';
            }
            
            notification.innerHTML = `
                <div class="notification-icon">${icon}</div>
                <div class="notification-content">${message}</div>
                <button class="notification-close">&times;</button>
            `;
            
            container.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                notification.classList.replace('fadeInRight', 'fadeOutRight');
                setTimeout(() => {
                    notification.remove();
                }, 500);
            }, 5000);
            
            // Close button functionality
            notification.querySelector('.notification-close').addEventListener('click', () => {
                notification.classList.replace('fadeInRight', 'fadeOutRight');
                setTimeout(() => {
                    notification.remove();
                }, 500);
            });
        }

        // Password strength validation
        function checkPasswordStrength(password) {
            // Define strength criteria
            const lengthValid = password.length >= 8;
            const hasUpperCase = /[A-Z]/.test(password);
            const hasLowerCase = /[a-z]/.test(password);
            const hasNumbers = /\d/.test(password);
            const hasSpecialChars = /[!@#$%^&*(),.?":{}|<>]/.test(password);
            
            // Calculate strength
            let strength = 0;
            if (lengthValid) strength += 1;
            if (hasUpperCase) strength += 1;
            if (hasLowerCase) strength += 1;
            if (hasNumbers) strength += 1;
            if (hasSpecialChars) strength += 1;
            
            // Return strength level and message
            if (strength === 5) {
                return { level: 'strong', message: 'Strong password! 💪' };
            } else if (strength >= 3) {
                return { level: 'medium', message: 'Medium strength password. Could be better.' };
            } else {
                return { level: 'weak', message: 'Weak password. Please make it stronger.' };
            }
        }

        // Form interaction notifications
        const signupForm = document.getElementById('signupForm');
        if (signupForm) {
            // Show welcome notification on page load
            setTimeout(() => {
                showNotification('Welcome to AI Ethics Platform! Create an account to get started.', 'info');
            }, 500);
            
            // Add focus effects to form fields
            const formInputs = signupForm.querySelectorAll('input');
            formInputs.forEach(input => {
                // Show helpful notifications on field focus
                input.addEventListener('focus', function() {
                    if (!this.dataset.focused) {
                        let message = '';
                        switch(this.name) {
                            case 'username':
                                message = 'Choose a unique username for your account';
                                break;
                            case 'email':
                                message = 'We\'ll use this email for account verification';
                                break;
                            case 'password1':
                                message = 'Create a strong password with at least 8 characters';
                                break;
                            case 'password2':
                                message = 'Confirm your password to ensure it matches';
                                break;
                            case 'first_name':
                            case 'last_name':
                                message = 'Enter your name as you would like it to appear';
                                break;
                            case 'organization':
                                message = 'Let us know which organization you represent';
                                break;
                            case 'job_title':
                                message = 'Your role helps us customize content for you';
                                break;
                        }
                        if (message) {
                            showNotification(message, 'info');
                        }
                        this.dataset.focused = 'true';
                    }
                });
                
                // Add floating label effect
                input.addEventListener('input', function() {
                    const label = this.closest('.form-group').querySelector('label');
                    if (this.value.length > 0) {
                        label.classList.add('active');
                    } else {
                        label.classList.remove('active');
                    }
                    
                    // Password strength indicator
                    if (this.name === 'password1' && this.value.length > 0) {
                        const strength = checkPasswordStrength(this.value);
                        showNotification(strength.message, strength.level === 'weak' ? 'warning' : 'info');
                    }
                    
                    // Password matching check
                    if (this.name === 'password2' && this.value.length > 0) {
                        const password1 = document.querySelector('[name="password1"]').value;
                        if (this.value !== password1) {
                            showNotification('Passwords don\'t match!', 'error');
                        } else if (this.value === password1 && this.value.length >= 8) {
                            showNotification('Passwords match! ✓', 'success');
                        }
                    }
                });
                
                // Trigger input event to initialize labels
                const event = new Event('input');
                input.dispatchEvent(event);
            });
            
            // Add form submission effect
            signupForm.addEventListener('submit', function(e) {
                const submitBtn = this.querySelector('button[type="submit"]');
                submitBtn.classList.add('loading');
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating account...';
                
                // Show processing notification
                showNotification('Creating your account...', 'info');
                
                // Note: We don't prevent the default form submission
                // since we want the actual submission to proceed
            });
        }
    });
</script>
{% endblock %}